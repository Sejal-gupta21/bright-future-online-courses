<app-navbar></app-navbar>
<div class="container mx-auto">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="status-message-card mx-auto my-5">
    <div class="spinner-border spinner-border-custom text-primary" role="status">
      <span class="visually-hidden">Loading course details...</span>
    </div>
    <p class="mt-4 fs-5 text-muted">Fetching all the amazing details for this course...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger alert-custom mx-auto my-5" role="alert">
    <h4 class="alert-heading fw-bold">Oops! Something went wrong.</h4>
    <p class="mb-2">{{ error }}</p>
    <hr>
    <p class="mb-0 text-sm">We couldn't load the course details. Please check your internet connection or try again later.</p>
  </div>

  <!-- Course Details Content -->
  <div *ngIf="!isLoading && !error && course">
    <!-- Upper Half: Hero Section with Image, Overlay, Title, Price, Buy Now -->
    <div class="hero-section" [style.backgroundImage]="'url(' + (course.imageUrl || 'https://placehold.co/1200x450/221c33/c2e9fb?text=Course+Hero') + ')'">
      <div class="hero-content">
        <h1 class="hero-course-title">{{ course.title }}</h1>
        <div class="d-flex align-items-baseline mb-3">
            <span class="hero-price">{{ course.price | currency:'USD':'symbol':'1.2-2' }}</span>
            <span *ngIf="course.isPremium && course.originalPrice > course.price" class="original-price ms-3">
                {{ course.originalPrice | currency:'USD':'symbol':'1.2-2' }}
            </span>
            <span *ngIf="course.isPremium" class="badge premium-badge ms-3">Premium</span>
        </div>
        <button class="btn btn-buy-now-hero" (click)="buyNow()">
            <span class="material-icons me-2">shopping_cart</span> Buy Now
        </button>
      </div>
    </div>

    <!-- Lower Half: About Course, Additional Info, etc. -->
    <div class="main-content-area row g-4">
      <div class="col-lg-8 desc-white">
        <!-- About the Course -->
        <div class="about-course-section">
          <h3>About this course</h3>
          <p class="mb-4">
            {{ course.fullDescription | slice:0:300 }}... <!-- Display first 300 characters, adjust as needed for ~50 words -->
            <span *ngIf="course.fullDescription.length > 300">
                <a href="#" class="text-info text-decoration-none">Read more</a>
            </span>
          </p>
        </div>
        <!-- Course Details -->
        <h4 class="content-heading">
            <span class="material-icons">verified_user</span> What you'll learn
        </h4>
        <ul class="rich-text-content learnings-list list-unstyled row row-cols-1 row-cols-sm-2">
            <li *ngFor="let point of course.keyLearningPoints" class="col mb-3">
              <span class="material-icons">check_circle</span> {{ point }}
            </li>
        </ul>

        <h4 class="content-heading mt-5">
            <span class="material-icons">assignment_late</span> Requirements
        </h4>
        <ul class="rich-text-content requirements-list list-unstyled row row-cols-1 row-cols-sm-2">
            <li *ngFor="let req of course.requirements" class="col mb-3">
              <span class="material-icons">info</span> {{ req }}
            </li>
        </ul>

        <h4 class="content-heading mt-5">
            <span class="material-icons">groups</span> Who is this course for?
        </h4>
        <ul class="rich-text-content whoisfor-list list-unstyled row row-cols-1 row-cols-sm-2">
            <li *ngFor="let target of course.whoIsFor" class="col mb-3">
              <span class="material-icons">person_add</span> {{ target }}
            </li>
        </ul>
      </div>

      <!-- Right Column: Additional Information Panel -->
      <div class="col-lg-4">
        <div class="additional-info-panel">
            <h5 class="fw-bold text-info mb-4">Course Snapshot</h5>
            <div class="info-item">
                <span class="material-icons">person</span>
                <span><strong>Instructor:</strong> {{ course.instructor }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">star</span>
                <span><strong>Rating:</strong> {{ course.rating }} ({{ course.numRatings }} ratings)</span>
            </div>
            <div class="info-item">
                <span class="material-icons">group</span>
                <span><strong>Students:</strong> {{ course.students }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">category</span>
                <span><strong>Category:</strong> {{ course.category }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">language</span>
                <span><strong>Language:</strong> {{ course.language }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">subtitles</span>
                <span><strong>Subtitles:</strong> {{ course.subtitles.join(', ') }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">business</span>
                <span><strong>Provider:</strong> {{ course.provider }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">update</span>
                <span><strong>Last Updated:</strong> {{ course.lastUpdatedDate }}</span>
            </div>
            <div class="info-item">
                <span class="material-icons">local_offer</span>
                <span><strong>Discount:</strong> {{ course.discountPercentage || 0 }}%</span>
            </div>
             <!-- Add to Cart button (can be placed here if you prefer a persistent one) -->
            <div class="d-grid mt-4">
              <button class="btn btn-add-to-cart-custom" (click)="addToCart()">
                  <span class="material-icons me-2">add_shopping_cart</span> Add to Cart
              </button>
            </div>
        </div>
      </div>
    </div>
  </div> 
</div>